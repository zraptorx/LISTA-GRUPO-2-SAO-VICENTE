<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chamada Mensal - G2 (com WhatsApp)</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:20px;background:#fff;color:#111}
    h1{font-size:20px;margin:0 0 6px 0}
    .muted{color:#666;font-size:12px;margin-bottom:10px}
    button,select,input,textarea{
      padding:10px;
      font-size:15px;
      border-radius:8px;
      border:1px solid #ccc;
      margin:4px 0;
      background:#fff;
    }
    button{cursor:pointer}
    button.primary{border-color:#111}
    button.danger{border-color:#a33;color:#a33}

    /* Tabela / rolagem */
    .tableWrap{
      width:100%;
      overflow-x:auto;
      -webkit-overflow-scrolling: touch; /* melhora no iPhone */
      border:1px solid #ddd;
      border-radius:12px;
      background:#fff;
    }

    table{
      border-collapse:collapse;
      width:max-content;   /* permite rolagem horizontal natural */
      min-width:100%;
      margin-top:0;
    }

    th,td{border:1px solid #ddd;padding:6px;text-align:center;white-space:nowrap}

    th{
      background:#f2f2f2;
      font-size:12px;
      position:sticky;
      top:0;
      z-index:3;
    }

    /* Coluna fixa do Nome */
    th.nameHead, td.name{
      position:sticky;
      left:0;
      z-index:4;
      background:#fff;
      text-align:left;
      min-width:260px;
      max-width:260px;
    }
    th.nameHead{
      background:#f2f2f2;
      z-index:5; /* acima do corpo */
    }
    th.nameHead, td.name{
      border-right:2px solid #ddd;
    }

    td.name{font-weight:600}
    td.day{min-width:38px}

    .present{background:#d1f3dc}

    .topbar{
      display:flex;flex-wrap:wrap;gap:10px;align-items:flex-end;
      padding:12px;border:1px solid #ddd;border-radius:12px;background:#fafafa;
      margin:12px 0;
    }
    .field{display:flex;flex-direction:column;gap:6px}
    .box{
      border:1px solid #ddd;border-radius:12px;padding:12px;background:#fff;margin-top:12px;
    }
    textarea{width:100%;min-height:130px;resize:vertical}
    .small{font-size:12px;color:#666}

    @media (max-width: 640px){
      th.nameHead, td.name{
        min-width:220px;
        max-width:220px;
      }
    }
  </style>
</head>
<body>

<h1>üìã Lista de Presen√ßa ‚Äì G2</h1>
<div class="muted">Clique no dia para marcar presen√ßa. A coluna ‚ÄúNome‚Äù fica fixa; s√≥ os dias deslizam. Tamb√©m gera texto pronto para WhatsApp com os presentes de um dia.</div>

<div class="topbar">
  <div class="field">
    <div class="small">M√™s</div>
    <select id="month"></select>
  </div>

  <div class="field">
    <div class="small">Ano</div>
    <select id="year"></select>
  </div>

  <div class="field">
    <div class="small">Dia (para relat√≥rio WhatsApp)</div>
    <select id="daySelect"></select>
  </div>

  <div class="field" style="flex:1;min-width:220px">
    <div class="small">Buscar (filtra a lista)</div>
    <input id="search" type="text" placeholder="Digite parte do nome..." />
  </div>

  <div class="field">
    <div class="small">&nbsp;</div>
    <button id="btnGenerate" class="primary">Gerar texto do dia</button>
  </div>

  <div class="field">
    <div class="small">&nbsp;</div>
    <button id="btnCopy" class="primary">Copiar para WhatsApp</button>
  </div>

  <div class="field">
    <div class="small">&nbsp;</div>
    <button id="btnClearDay" class="danger">Limpar dia</button>
  </div>
</div>

<div class="tableWrap">
  <table id="table"></table>
</div>

<div class="box">
  <div class="small" style="margin-bottom:6px;">Texto pronto para compartilhar no WhatsApp</div>
  <textarea id="waText" readonly></textarea>
  <div class="small" style="margin-top:8px;">
    Dica: clique em ‚ÄúCopiar para WhatsApp‚Äù e cole no grupo/conversa.
  </div>
</div>

<script>
/**
 * Armazenamento:
 * - Para cada m√™s/ano, salvamos em localStorage numa chave "YYYY-MM" (ex.: 2025-12)
 * - Cada marca√ß√£o fica em data[i+"-"+d] = true (i = √≠ndice da pessoa na lista, d = dia do m√™s)
 */

const pessoas = [
  "DEBORA MARGARETE C. SANTOS","AGUINALDO BARBOSA","ANNA AM√âLIA S. CAMARGO",
  "CAMILA CRISTINE DOS SANTOS","CAMILA VENTURA SIM√ÉO MACEDO","CARLA BEATRICE FERREIRA PINTO",
  "CASSIUS CLAY MACEDO","GABRIEL SOUZA DOS SANTOS","GABRIELA RICARTE SANTOS",
  "GLEISON CORREIA","JORGE NICOL√ÅS PEREDO PINTO","JOSEFA MARIA DE JESUS CAMPOS",
  "JOS√â CARLOS MENEZES SANTOS","JO√ÉO HENRIQUE M. S. CORREIA","KALEU DA SILVA OLIVEIRA",
  "KARINA S. O. PEDRINI","LUDMILA MATHIAS","NIVALDO DE JESUS SOARES",
  "PATR√çCIA SANTOS DE LIMA","RACHEL RICARTE FREITAS","ROMULO PEREDO MURTHA",
  "SAMUEL CARLOS G. M. MENEZES","SOFIA JESUS DOS SANTOS","VALENTINA PEREDO PINTO",
  "VERA LUCIA CONCEI√á√ÉO SANTOS","WALTER CAMPOS FERREIRA","WILLIAN JESUS SANTOS",
  "YASMIN FERREIRA VIEIRA SOARES","ANDREIA SILVA GON√áALVES",
  "CILENE CRISTINA S. BARBOSA","GILBERTO DOS SANTOS"
];

const monthSel = document.getElementById("month");
const yearSel  = document.getElementById("year");
const daySel   = document.getElementById("daySelect");
const table    = document.getElementById("table");
const searchEl = document.getElementById("search");
const waText   = document.getElementById("waText");

const months = ["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];

months.forEach((m,i)=>{
  const o=document.createElement("option");
  o.value=i; o.text=m;
  monthSel.appendChild(o);
});

const now = new Date();
monthSel.value = now.getMonth();

for(let y=now.getFullYear()-1; y<=now.getFullYear()+2; y++){
  const o=document.createElement("option");
  o.value=y; o.text=y;
  yearSel.appendChild(o);
}
yearSel.value = now.getFullYear();

function daysInMonth(y,m){ return new Date(y, m+1, 0).getDate(); }

function monthKey(){
  const y = yearSel.value;
  const m = String(Number(monthSel.value)+1).padStart(2,"0");
  return y + "-" + m;
}

function loadData(){
  return JSON.parse(localStorage.getItem(monthKey()) || "{}");
}

function saveData(data){
  localStorage.setItem(monthKey(), JSON.stringify(data));
}

function refreshDaySelect(){
  const days = daysInMonth(Number(yearSel.value), Number(monthSel.value));
  const keep = Number(daySel.value || 1);
  daySel.innerHTML = "";
  for(let d=1; d<=days; d++){
    const o=document.createElement("option");
    o.value=d; o.text=d;
    daySel.appendChild(o);
  }
  daySel.value = (keep>=1 && keep<=days) ? String(keep) : "1";
}

function normalize(s){
  return (s||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");
}

function getFilteredIndexes(){
  const q = normalize(searchEl.value.trim());
  if(!q) return pessoas.map((_,i)=>i);
  const idx=[];
  pessoas.forEach((nome,i)=>{
    if(normalize(nome).includes(q)) idx.push(i);
  });
  return idx;
}

window.toggle = function(i, d){
  const data = loadData();
  const k = i + "-" + d;
  data[k] = !data[k];
  if(!data[k]) delete data[k];
  saveData(data);
  render();
  generateWhatsAppText(); // mant√©m o texto sempre atualizado
}

function render(){
  const y = Number(yearSel.value);
  const m = Number(monthSel.value);
  const days = daysInMonth(y,m);
  refreshDaySelect();

  const data = loadData();
  const visible = getFilteredIndexes();

  // Header
  let html = "<tr><th class='nameHead'>Nome</th>";
  for(let d=1; d<=days; d++) html += "<th>" + d + "</th>";
  html += "</tr>";

  // Rows
  visible.forEach((i)=>{
    const nome = pessoas[i];
    html += "<tr><td class='name'>" + nome + "</td>";
    for(let d=1; d<=days; d++){
      const mark = !!data[i + "-" + d];
      html += "<td class='day " + (mark ? "present" : "") + "' onclick='toggle(" + i + "," + d + ")'>" + (mark ? "‚úì" : "") + "</td>";
    }
    html += "</tr>";
  });

  table.innerHTML = html;
}

function getPresentNamesForDay(d){
  const data = loadData();
  const presentes = [];
  for(let i=0; i<pessoas.length; i++){
    if(data[i + "-" + d]) presentes.push(pessoas[i]);
  }
  presentes.sort((a,b)=>a.localeCompare(b,"pt-BR"));
  return presentes;
}

function generateWhatsAppText(){
  const d = Number(daySel.value || 1);
  const y = Number(yearSel.value);
  const m = Number(monthSel.value) + 1;

  const dd = String(d).padStart(2,"0");
  const mm = String(m).padStart(2,"0");

  const presentes = getPresentNamesForDay(d);

  if(presentes.length === 0){
    waText.value = "üìã G2 ‚Äî Presen√ßa (" + dd + "/" + mm + "/" + y + ")\n\nNenhuma presen√ßa marcada.";
    return;
  }

  const linhas = presentes.map((nome, idx)=> (idx+1) + ". " + nome).join("\n");

  waText.value =
    "üìã G2 ‚Äî Presen√ßa (" + dd + "/" + mm + "/" + y + ")\n" +
    "Total: " + presentes.length + "\n\n" +
    linhas;
}

async function copyWhatsAppText(){
  try{
    await navigator.clipboard.writeText(waText.value);
    alert("Copiado! Agora √© s√≥ colar no WhatsApp.");
  }catch(e){
    waText.select();
    document.execCommand("copy");
    alert("Copiado! Agora √© s√≥ colar no WhatsApp.");
  }
}

function clearSelectedDay(){
  const d = Number(daySel.value || 1);
  if(!confirm("Confirma limpar as presen√ßas do dia " + d + "?")) return;
  const data = loadData();
  for(let i=0; i<pessoas.length; i++){
    const k = i + "-" + d;
    if(data[k]) delete data[k];
  }
  saveData(data);
  render();
  generateWhatsAppText();
}

document.getElementById("btnGenerate").addEventListener("click", generateWhatsAppText);
document.getElementById("btnCopy").addEventListener("click", copyWhatsAppText);
document.getElementById("btnClearDay").addEventListener("click", clearSelectedDay);

monthSel.addEventListener("change", ()=>{ render(); generateWhatsAppText(); });
yearSel.addEventListener("change", ()=>{ render(); generateWhatsAppText(); });
daySel.addEventListener("change", generateWhatsAppText);
searchEl.addEventListener("input", render);

// init
refreshDaySelect();
daySel.value = String(now.getDate());
render();
generateWhatsAppText();
</script>

</body>
</html>
